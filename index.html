<script>
  /* INTRO */
  window.addEventListener("load", () => {
    const intro = document.getElementById("intro");
    setTimeout(() => {
      intro.classList.add("hide");
      setTimeout(() => intro.remove(), 400);
    }, 2700);
  });

  /* Galery fade-in */
  document.querySelectorAll(".gallery img").forEach(img => {
    const load = () => img.classList.add("loaded");
    img.addEventListener("load", load);
    if (img.complete) load();
  });

  /* ✅ NOUVEAUTÉ : ajoute automatiquement un texte sous chaque image (nom du fichier) */
  document.querySelectorAll(".work img").forEach(img => {
    const src = img.getAttribute("src");
    if (!src) return;

    // photo27.jpg -> photo27
    const fileName = src.split("/").pop().split(".")[0];

    // évite d'ajouter 2 fois si tu refresh / modifies
    const already = img.parentElement.querySelector(".caption");
    if (already) return;

    const caption = document.createElement("div");
    caption.className = "caption";
    caption.textContent = fileName;

    img.insertAdjacentElement("afterend", caption);
  });

  /* Lightbox */
  const links = Array.from(document.querySelectorAll("a.work"));
  const lb = document.getElementById("lightbox");
  const lbImg = document.getElementById("lbImg");
  const lbPrev = document.getElementById("lbPrev");
  const lbNext = document.getElementById("lbNext");
  const lbClose = document.getElementById("lbClose");
  let index = 0;

  function openLB(i) {
    index = i;
    lbImg.src = links[index].getAttribute("href");
    lb.classList.add("open");
    document.body.style.overflow = "hidden";
  }
  function closeLB() {
    lb.classList.remove("open");
    lbImg.src = "";
    document.body.style.overflow = "";
  }
  function prev() {
    index = (index - 1 + links.length) % links.length;
    lbImg.src = links[index].getAttribute("href");
  }
  function next() {
    index = (index + 1) % links.length;
    lbImg.src = links[index].getAttribute("href");
  }

  links.forEach((a, i) => a.addEventListener("click", e => {
    e.preventDefault();
    openLB(i);
  }));

  lbPrev.addEventListener("click", prev);
  lbNext.addEventListener("click", next);
  lbClose.addEventListener("click", closeLB);
  lb.addEventListener("click", e => { if (e.target === lb) closeLB(); });

  window.addEventListener("keydown", e => {
    if (!lb.classList.contains("open")) return;
    if (e.key === "Escape") closeLB();
    if (e.key === "ArrowLeft") prev();
    if (e.key === "ArrowRight") next();
  });
</script>
